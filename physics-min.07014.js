(function e(t,i,r){function o(a,s){if(!i[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(n)return n(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[a]={exports:{}};t[a][0].call(u.exports,function(e){return o(t[a][1][e]||e)},u,u.exports,e,t,i,r)}return i[a].exports}for(var n="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o})({1:[function(e,t,i){"use strict";i.__esModule=!0,i.BuiltinSharedBody=void 0;var r=e("../framework/util");function o(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var n=cc.geomUtils.intersect,a=cc.js.array.fastRemove,s=new cc.Vec3,l=new cc.Vec3,c=new cc.Quat,u=function(){function e(t,i){this._id=void 0,this.index=-1,this.ref=0,this.node=void 0,this.world=void 0,this.shapes=[],this._id=e.idCounter++,this.node=t,this.world=i}e.getSharedBody=function(t,i){var r=t._id;if(e.sharedBodiesMap.has(r))return e.sharedBodiesMap.get(r);var o=new e(t,i);return e.sharedBodiesMap.set(t._id,o),o};var t,i,u=e.prototype;return u.intersects=function(e){for(var t=0;t<this.shapes.length;t++)for(var i=this.shapes[t],r=0;r<e.shapes.length;r++){var o=e.shapes[r];n.resolve(i.worldShape,o.worldShape)&&(this.world.shapeArr.push(i),this.world.shapeArr.push(o))}},u.addShape=function(e){this.shapes.indexOf(e)<0&&this.shapes.push(e)},u.removeShape=function(e){a(this.shapes,e)},u.syncSceneToPhysics=function(e){void 0===e&&(e=!1);var t=this.node,i=(0,r.worldDirty)(t);if(e||i){t.getWorldPosition(s),t.getWorldRotation(c),t.getWorldScale(l);for(var o=0;o<this.shapes.length;o++)this.shapes[o].transform(t._worldMatrix,s,c,l)}},u.destory=function(){e.sharedBodiesMap.delete(this.node._id),this.node=null,this.world=null,this.shapes=null},t=e,(i=[{key:"id",get:function(){return this._id}},{key:"enabled",set:function(e){e?this.index<0&&(this.index=this.world.bodies.length,this.world.addSharedBody(this),this.syncSceneToPhysics(!0)):this.index>=0&&0==this.shapes.length&&(this.index=-1,this.world.removeSharedBody(this))}},{key:"reference",set:function(e){e?this.ref++:this.ref--,0==this.ref&&this.destory()}}])&&o(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();i.BuiltinSharedBody=u,u.sharedBodiesMap=new Map,u.idCounter=0},{"../framework/util":21}],2:[function(e,t,i){"use strict";i.__esModule=!0,i.BuiltInWorld=void 0;var r=e("./builtin-shared-body"),o=e("./utils/array-collision-matrix"),n=e("../framework/util");function a(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=cc.js.array.fastRemove,l=cc.geomUtils.intersect,c=cc.Vec3,u=new c,p={type:"collision-enter",selfCollider:null,otherCollider:null},d=function(){function e(){this.shapeArr=[],this.bodies=[],this._shapeArrOld=[],this._collisionMatrix=new o.ArrayCollisionMatrix,this._collisionMatrixPrev=new o.ArrayCollisionMatrix}var t,i,d=e.prototype;return d.step=function(){this._shapeArrOld=this.shapeArr.slice(),this.shapeArr.length=0,(0,n.clearNodeTransformRecord)();for(var e=0;e<this.bodies.length;e++)this.bodies[e].syncSceneToPhysics();(0,n.clearNodeTransformDirtyFlag)();for(var t=cc.game.collisionMatrix,i=0;i<this.bodies.length;i++){var r=this.bodies[i],o=r.node,a=t[o.groupIndex];if(a)for(var s=i+1;s<this.bodies.length;s++){var l=this.bodies[s],c=l.node;o!==c&&a[c.groupIndex]&&r.intersects(l)}}this.emitColliderEvent()},d.raycastClosest=function(e,t,i){var r=1/0,o=t.maxDistance,n=t.groupIndex,a=cc.game.collisionMatrix[n];if(!a)return!1;for(var s=0;s<this.bodies.length;s++){var p=this.bodies[s];if(a[p.node.groupIndex])for(var d=0;d<p.shapes.length;d++){var h=p.shapes[d],f=l.resolve(e,h.worldShape);0==f||f>o||r>f&&(r=f,c.normalize(u,e.d),c.scaleAndAdd(u,e.o,u,f),i._assign(u,f,h.collider))}}return!(r==1/0)},d.raycast=function(e,t,i,r){var o=t.maxDistance,n=t.groupIndex,a=cc.game.collisionMatrix[n];if(!a)return!1;for(var s=0;s<this.bodies.length;s++){var c=this.bodies[s];if(a[c.node.groupIndex])for(var p=0;p<c.shapes.length;p++){var d=c.shapes[p],h=l.resolve(e,d.worldShape);if(!(0==h||h>o)){var f=i.add();e.computeHit(u,h),f._assign(u,h,d.collider),r.push(f)}}}return r.length>0},d.getSharedBody=function(e){return r.BuiltinSharedBody.getSharedBody(e,this)},d.addSharedBody=function(e){this.bodies.indexOf(e)<0&&this.bodies.push(e)},d.removeSharedBody=function(e){s(this.bodies,e)},d.emitColliderEvent=function(){for(var e,t,i=0;i<this.shapeArr.length;i+=2)e=this.shapeArr[i],t=this.shapeArr[i+1],p.selfCollider=e.collider,p.otherCollider=t.collider,this._collisionMatrix.set(e.id,t.id,!0),this._collisionMatrixPrev.get(e.id,t.id)?p.type="trigger-stay":p.type="trigger-enter",e.collider&&e.collider.emit(p.type,p),p.selfCollider=t.collider,p.otherCollider=e.collider,t.collider&&t.collider.emit(p.type,p);for(var r=0;r<this._shapeArrOld.length;r+=2)e=this._shapeArrOld[r],t=this._shapeArrOld[r+1],this._collisionMatrixPrev.get(e.id,t.id)&&(this._collisionMatrix.get(e.id,t.id)||(p.type="trigger-exit",p.selfCollider=e.collider,p.otherCollider=t.collider,e.collider&&e.collider.emit(p.type,p),p.selfCollider=t.collider,p.otherCollider=e.collider,t.collider&&t.collider.emit(p.type,p),this._collisionMatrix.set(e.id,t.id,!1)));this._collisionMatrixPrev.matrix=this._collisionMatrix.matrix.slice(),this._collisionMatrix.reset()},t=e,(i=[{key:"gravity",set:function(){}},{key:"allowSleep",set:function(){}},{key:"defaultMaterial",set:function(){}}])&&a(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();i.BuiltInWorld=d},{"../framework/util":21,"./builtin-shared-body":1,"./utils/array-collision-matrix":7}],3:[function(e){"use strict";var t=e("../framework/physics-selector"),i=e("./builtin-world"),r=e("./shapes/builtin-box-shape"),o=e("./shapes/builtin-sphere-shape");(0,t.instantiate)(r.BuiltinBoxShape,o.BuiltinSphereShape,null,i.BuiltInWorld)},{"../framework/physics-selector":20,"./builtin-world":2,"./shapes/builtin-box-shape":4,"./shapes/builtin-sphere-shape":6}],4:[function(e,t,i){"use strict";i.__esModule=!0,i.BuiltinBoxShape=void 0;var r=e("./builtin-shape");function o(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,t){return(n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var a=cc.geomUtils.Obb,s=cc.Vec3,l=new s,c=function(e){var t,i,r,c;function u(t){var i;return(i=e.call(this)||this)._localShape=new a,i._worldShape=new a,s.multiplyScalar(i.localObb.halfExtents,t,.5),s.copy(i.worldObb.halfExtents,i.localObb.halfExtents),i}return i=e,(t=u).prototype=Object.create(i.prototype),t.prototype.constructor=t,n(t,i),u.prototype.onLoad=function(){e.prototype.onLoad.call(this),this.size=this.boxCollider.size},r=u,(c=[{key:"localObb",get:function(){return this._localShape}},{key:"worldObb",get:function(){return this._worldShape}},{key:"boxCollider",get:function(){return this.collider}},{key:"size",set:function(e){s.multiplyScalar(this.localObb.halfExtents,e,.5),this.collider.node.getWorldScale(l),l.x=Math.abs(l.x),l.y=Math.abs(l.y),l.z=Math.abs(l.z),s.multiply(this.worldObb.halfExtents,this.localObb.halfExtents,l)}}])&&o(r.prototype,c),Object.defineProperty(r,"prototype",{writable:!1}),u}(r.BuiltinShape);i.BuiltinBoxShape=c},{"./builtin-shape":5}],5:[function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}i.__esModule=!0,i.BuiltinShape=void 0;var o=cc.Vec3,n=function(){function e(){this.id=e.idCounter++,this._sharedBody=void 0,this._collider=void 0,this._localShape=void 0,this._worldShape=void 0}var t,i,n=e.prototype;return n.__preload=function(e){this._collider=e,this._sharedBody=cc.director.getPhysics3DManager().physicsWorld.getSharedBody(this._collider.node),this._sharedBody.reference=!0},n.onLoad=function(){this.center=this._collider.center},n.onEnable=function(){this._sharedBody.addShape(this),this._sharedBody.enabled=!0},n.onDisable=function(){this._sharedBody.removeShape(this),this._sharedBody.enabled=!1},n.onDestroy=function(){this._sharedBody.reference=!1,this._collider=null,this._localShape=null,this._worldShape=null},n.transform=function(e,t,i,r){this._localShape.transform(e,t,i,r,this._worldShape)},t=e,(i=[{key:"material",set:function(){}},{key:"isTrigger",set:function(){}},{key:"attachedRigidBody",get:function(){return null}},{key:"center",set:function(e){o.copy(this._localShape.center,e)}},{key:"localShape",get:function(){return this._worldShape}},{key:"worldShape",get:function(){return this._worldShape}},{key:"sharedBody",get:function(){return this._sharedBody}},{key:"collider",get:function(){return this._collider}}])&&r(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();i.BuiltinShape=n,n.idCounter=0},{}],6:[function(e,t,i){"use strict";i.__esModule=!0,i.BuiltinSphereShape=void 0;var r=e("./builtin-shape");function o(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,t){return(n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var a=cc.geomUtils.Sphere,s=new cc.Vec3,l=function(e){var t,i,r,l;function c(t){var i;return(i=e.call(this)||this)._localShape=new a(0,0,0,t),i._worldShape=new a(0,0,0,t),i}return i=e,(t=c).prototype=Object.create(i.prototype),t.prototype.constructor=t,n(t,i),c.prototype.onLoad=function(){e.prototype.onLoad.call(this),this.radius=this.sphereCollider.radius},r=c,(l=[{key:"radius",set:function(e){this.localSphere.radius=e,this.collider.node.getWorldScale(s);var t=s.maxAxis();this.worldSphere.radius=this.localSphere.radius*t}},{key:"localSphere",get:function(){return this._localShape}},{key:"worldSphere",get:function(){return this._worldShape}},{key:"sphereCollider",get:function(){return this.collider}}])&&o(r.prototype,l),Object.defineProperty(r,"prototype",{writable:!1}),c}(r.BuiltinShape);i.BuiltinSphereShape=l},{"./builtin-shape":5}],7:[function(e,t,i){"use strict";i.__esModule=!0,i.ArrayCollisionMatrix=void 0;var r=function(){function e(){this.matrix=[]}var t=e.prototype;return t.get=function(e,t){if(t>e){var i=t;t=e,e=i}return this.matrix[(e*(e+1)>>1)+t-1]},t.set=function(e,t,i){if(t>e){var r=t;t=e,e=r}this.matrix[(e*(e+1)>>1)+t-1]=i?1:0},t.reset=function(){for(var e=0,t=this.matrix.length;e!==t;e++)this.matrix[e]=0},t.setNumObjects=function(e){this.matrix.length=e*(e-1)>>1},e}();i.ArrayCollisionMatrix=r},{}],8:[function(e){"use strict";e("../cocos/instantiate")},{"../cocos/instantiate":3}],9:[function(e,t,i){"use strict";i.__esModule=!0;var r=e("../framework");Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&(e in i&&i[e]===r[e]||(i[e]=r[e]))})},{"../framework":16}],10:[function(e,t,i){"use strict";var r,o,n,a,s;function l(e,t,i,r){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0})}function c(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t){return(p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function d(e,t,i,r,o){var n={};return Object.keys(r).forEach(function(e){n[e]=r[e]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=i.slice().reverse().reduce(function(i,r){return r(e,t,i)||i},n),o&&void 0!==n.initializer&&(n.value=n.initializer?n.initializer.call(o):void 0,n.initializer=void 0),void 0===n.initializer&&(Object.defineProperty(e,t,n),n=null),n}i.__esModule=!0,i.PhysicsMaterial=void 0;var h=cc._decorator,f=h.ccclass,y=h.property,b=cc.js.array.fastRemove,_=cc.math.equals,g=f("cc.PhysicsMaterial")(((s=function(e){var t,i;function r(){var t;return l(t=e.call(this)||this,"_friction",n,u(t)),l(t,"_restitution",a,u(t)),cc.EventTarget.call(u(t)),r.allMaterials.push(u(t)),""==t._uuid&&(t._uuid="pm_"+r._idCounter++),t}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,p(t,i);var o,s,d=r.prototype;return d.clone=function(){var e=new r;return e._friction=this._friction,e._restitution=this._restitution,e},d.destroy=function(){return!!e.prototype.destroy.call(this)&&(b(r.allMaterials,this),!0)},o=r,(s=[{key:"friction",get:function(){return this._friction},set:function(e){_(this._friction,e)||(this._friction=e,this.emit("physics_material_update"))}},{key:"restitution",get:function(){return this._restitution},set:function(e){_(this._restitution,e)||(this._restitution=e,this.emit("physics_material_update"))}}])&&c(o.prototype,s),Object.defineProperty(o,"prototype",{writable:!1}),r}(cc.Asset)).allMaterials=[],s._idCounter=0,n=d((o=s).prototype,"_friction",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),a=d(o.prototype,"_restitution",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),d(o.prototype,"friction",[y],Object.getOwnPropertyDescriptor(o.prototype,"friction"),o.prototype),d(o.prototype,"restitution",[y],Object.getOwnPropertyDescriptor(o.prototype,"restitution"),o.prototype),r=o))||r;i.PhysicsMaterial=g,cc.js.mixin(g.prototype,cc.EventTarget.prototype),cc.PhysicsMaterial=g},{}],11:[function(e,t,i){"use strict";i.__esModule=!0,i.BoxCollider3D=void 0;var r,o,n,a,s,l,c,u,p=e("../../instance"),d=e("./collider-component");function h(e,t,i,r){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0})}function f(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function b(e,t){return(b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _(e,t,i,r,o){var n={};return Object.keys(r).forEach(function(e){n[e]=r[e]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=i.slice().reverse().reduce(function(i,r){return r(e,t,i)||i},n),o&&void 0!==n.initializer&&(n.value=n.initializer?n.initializer.call(o):void 0,n.initializer=void 0),void 0===n.initializer&&(Object.defineProperty(e,t,n),n=null),n}var g=cc._decorator,m=g.ccclass,v=g.executeInEditMode,w=g.executionOrder,O=g.menu,x=g.property,P=g.help,S=cc.Vec3,M=(r=m("cc.BoxCollider3D"),o=w(98),n=O("i18n:MAIN_MENU.component.physics/Collider/Box 3D"),a=P("i18n:COMPONENT.help_url.physics-collider"),s=x({type:cc.Vec3}),r(l=o(l=n(l=v(l=a((_((c=function(e){var t,i,r,o;function n(){var t;return h(t=e.call(this)||this,"_size",u,y(t)),t._shape=(0,p.createBoxShape)(t._size),t}return i=e,(t=n).prototype=Object.create(i.prototype),t.prototype.constructor=t,b(t,i),r=n,(o=[{key:"size",get:function(){return this._size},set:function(e){S.copy(this._size,e),this.boxShape.size=this._size}},{key:"boxShape",get:function(){return this._shape}}])&&f(r.prototype,o),Object.defineProperty(r,"prototype",{writable:!1}),n}(d.Collider3D)).prototype,"size",[s],Object.getOwnPropertyDescriptor(c.prototype,"size"),c.prototype),u=_(c.prototype,"_size",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new S(1,1,1)}}),l=c))||l)||l)||l)||l)||l);i.BoxCollider3D=M},{"../../instance":17,"./collider-component":12}],12:[function(e,t,i){"use strict";i.__esModule=!0,i.Collider3D=void 0;var r,o,n,a,s,l,c,u,p,d,h=e("../../assets/physics-material");function f(e,t,i,r){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0})}function y(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _(e,t){return(_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function g(e,t,i,r,o){var n={};return Object.keys(r).forEach(function(e){n[e]=r[e]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=i.slice().reverse().reduce(function(i,r){return r(e,t,i)||i},n),o&&void 0!==n.initializer&&(n.value=n.initializer?n.initializer.call(o):void 0,n.initializer=void 0),void 0===n.initializer&&(Object.defineProperty(e,t,n),n=null),n}var m=cc._decorator,v=m.ccclass,w=m.property,O=cc.Vec3,x=(r=v("cc.Collider3D"),o=w({type:h.PhysicsMaterial,displayName:"Material",displayOrder:-1}),n=w({displayOrder:0}),a=w({type:cc.Vec3,displayOrder:1}),s=w({type:h.PhysicsMaterial}),r((g((c=function(e){var t,i;function r(){var t;return(t=e.call(this)||this)._shape=void 0,t._isSharedMaterial=!0,f(t,"_material",u,b(t)),f(t,"_isTrigger",p,b(t)),f(t,"_center",d,b(t)),cc.EventTarget.call(b(t)),t}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,_(t,i);var o,n,a=r.prototype;return a.on=function(){},a.off=function(){},a.once=function(){},a.emit=function(){},a.__preload=function(){this._shape.__preload(this)},a.onLoad=function(){this._shape.onLoad()},a.onEnable=function(){this._shape.onEnable()},a.onDisable=function(){this._shape.onDisable()},a.onDestroy=function(){this._material&&this._material.off("physics_material_update",this._updateMaterial,this),this._shape.onDestroy()},a._updateMaterial=function(){this._shape.material=this._material},o=r,(n=[{key:"sharedMaterial",get:function(){return this._material},set:function(e){this.material=e}},{key:"material",get:function(){return this._material},set:function(e){this._material=e}},{key:"isTrigger",get:function(){return this._isTrigger},set:function(e){this._isTrigger=e,this._shape.isTrigger=this._isTrigger}},{key:"center",get:function(){return this._center},set:function(e){O.copy(this._center,e),this._shape.center=this._center}},{key:"attachedRigidbody",get:function(){return this.shape.attachedRigidBody}},{key:"shape",get:function(){return this._shape}},{key:"_assertOnload",get:function(){var e=0==this._isOnLoadCalled;return e&&cc.error("Physics Error: Please make sure that the node has been added to the scene"),!e}}])&&y(o.prototype,n),Object.defineProperty(o,"prototype",{writable:!1}),r}(cc.Component)).prototype,"sharedMaterial",[o],Object.getOwnPropertyDescriptor(c.prototype,"sharedMaterial"),c.prototype),g(c.prototype,"isTrigger",[n],Object.getOwnPropertyDescriptor(c.prototype,"isTrigger"),c.prototype),g(c.prototype,"center",[a],Object.getOwnPropertyDescriptor(c.prototype,"center"),c.prototype),u=g(c.prototype,"_material",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),p=g(c.prototype,"_isTrigger",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),d=g(c.prototype,"_center",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new O}}),l=c))||l);i.Collider3D=x,cc.js.mixin(x.prototype,cc.EventTarget.prototype)},{"../../assets/physics-material":10}],13:[function(e,t,i){"use strict";i.__esModule=!0,i.SphereCollider3D=void 0;var r,o,n,a=e("../../instance"),s=e("./collider-component");function l(e,t,i,r){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0})}function c(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t){return(p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function d(e,t,i,r,o){var n={};return Object.keys(r).forEach(function(e){n[e]=r[e]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=i.slice().reverse().reduce(function(i,r){return r(e,t,i)||i},n),o&&void 0!==n.initializer&&(n.value=n.initializer?n.initializer.call(o):void 0,n.initializer=void 0),void 0===n.initializer&&(Object.defineProperty(e,t,n),n=null),n}var h=cc._decorator,f=h.ccclass,y=h.executeInEditMode,b=h.executionOrder,_=h.menu,g=h.property,m=h.help,v=f("cc.SphereCollider3D")(r=b(98)(r=_("i18n:MAIN_MENU.component.physics/Collider/Sphere 3D")(r=m("i18n:COMPONENT.help_url.physics-collider")(r=y((d((o=function(e){var t,i,r,o;function s(){var t;return l(t=e.call(this)||this,"_radius",n,u(t)),t._shape=(0,a.createSphereShape)(t._radius),t}return i=e,(t=s).prototype=Object.create(i.prototype),t.prototype.constructor=t,p(t,i),r=s,(o=[{key:"radius",get:function(){return this._radius},set:function(e){this._radius=e,this.sphereShape.radius=this._radius}},{key:"sphereShape",get:function(){return this._shape}}])&&c(r.prototype,o),Object.defineProperty(r,"prototype",{writable:!1}),s}(s.Collider3D)).prototype,"radius",[g],Object.getOwnPropertyDescriptor(o.prototype,"radius"),o.prototype),n=d(o.prototype,"_radius",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),r=o))||r)||r)||r)||r)||r;i.SphereCollider3D=v},{"../../instance":17,"./collider-component":12}],14:[function(e,t,i){"use strict";i.__esModule=!0,i.ConstantForce=void 0;var r,o,n,a,s,l,c,u,p,d,h,f,y,b,_,g=e("./rigid-body-component");function m(e,t,i,r){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0})}function v(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function O(e,t){return(O=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function x(e,t,i,r,o){var n={};return Object.keys(r).forEach(function(e){n[e]=r[e]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=i.slice().reverse().reduce(function(i,r){return r(e,t,i)||i},n),o&&void 0!==n.initializer&&(n.value=n.initializer?n.initializer.call(o):void 0,n.initializer=void 0),void 0===n.initializer&&(Object.defineProperty(e,t,n),n=null),n}var P=cc._decorator,S=P.ccclass,M=P.executeInEditMode,D=P.executionOrder,k=P.menu,z=P.property,j=P.requireComponent,B=P.disallowMultiple,C=P.help,R=cc.Vec3,T=(r=S("cc.ConstantForce"),o=D(98),n=j(g.RigidBody3D),a=k("i18n:MAIN_MENU.component.physics/Constant Force 3D"),s=C("i18n:COMPONENT.help_url.constantforce"),l=z({displayOrder:0}),c=z({displayOrder:1}),u=z({displayOrder:2}),p=z({displayOrder:3}),r(d=o(d=n(d=a(d=s(d=B(d=M((h=function(e){var t,i;function r(){for(var t,i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(t=e.call.apply(e,[this].concat(r))||this)._rigidbody=null,m(t,"_force",f,w(t)),m(t,"_localForce",y,w(t)),m(t,"_torque",b,w(t)),m(t,"_localTorque",_,w(t)),t._mask=0,t}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,O(t,i);var o,n,a=r.prototype;return a.onLoad=function(){},a.lateUpdate=function(){},a._maskUpdate=function(e,t){R.strictEquals(e,R.ZERO)?this._mask&=~t:this._mask|=t},o=r,(n=[{key:"force",get:function(){return this._force},set:function(e){R.copy(this._force,e),this._maskUpdate(this._force,1)}},{key:"localForce",get:function(){return this._localForce},set:function(e){R.copy(this._localForce,e),this._maskUpdate(this.localForce,2)}},{key:"torque",get:function(){return this._torque},set:function(e){R.copy(this._torque,e),this._maskUpdate(this._torque,4)}},{key:"localTorque",get:function(){return this._localTorque},set:function(e){R.copy(this._localTorque,e),this._maskUpdate(this._localTorque,8)}}])&&v(o.prototype,n),Object.defineProperty(o,"prototype",{writable:!1}),r}(cc.Component),f=x(h.prototype,"_force",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new R}}),y=x(h.prototype,"_localForce",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new R}}),b=x(h.prototype,"_torque",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new R}}),_=x(h.prototype,"_localTorque",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new R}}),x(h.prototype,"force",[l],Object.getOwnPropertyDescriptor(h.prototype,"force"),h.prototype),x(h.prototype,"localForce",[c],Object.getOwnPropertyDescriptor(h.prototype,"localForce"),h.prototype),x(h.prototype,"torque",[u],Object.getOwnPropertyDescriptor(h.prototype,"torque"),h.prototype),x(h.prototype,"localTorque",[p],Object.getOwnPropertyDescriptor(h.prototype,"localTorque"),h.prototype),d=h))||d)||d)||d)||d)||d)||d)||d);i.ConstantForce=T},{"./rigid-body-component":15}],15:[function(e,t,i){"use strict";var r,o,n,a,s,l,c,u,p,d,h,f,y,b,_,g,m,v,w,O,x,P;function S(e,t,i,r){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0})}function M(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function D(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function k(e,t){return(k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function z(e,t,i,r,o){var n={};return Object.keys(r).forEach(function(e){n[e]=r[e]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=i.slice().reverse().reduce(function(i,r){return r(e,t,i)||i},n),o&&void 0!==n.initializer&&(n.value=n.initializer?n.initializer.call(o):void 0,n.initializer=void 0),void 0===n.initializer&&(Object.defineProperty(e,t,n),n=null),n}i.__esModule=!0,i.RigidBody3D=void 0,e("../instance");var j=cc._decorator,B=j.ccclass,C=j.disallowMultiple,R=j.executeInEditMode,T=j.executionOrder,E=j.menu,F=j.property,A=j.help,q=cc.Vec3,N=(r=B("cc.RigidBody3D"),o=T(99),n=E("i18n:MAIN_MENU.component.physics/Rigid Body 3D"),a=A("i18n:COMPONENT.help_url.physics-rigidbody"),s=F({displayOrder:0}),l=F({displayOrder:1}),c=F({displayOrder:2}),u=F({displayOrder:3}),p=F({displayOrder:4}),d=F({displayOrder:5}),h=F({displayOrder:6}),f=F({displayOrder:7}),r(y=o(y=n(y=a(y=R(y=C((z((b=function(e){var t,i;function r(){var t;return(t=e.call(this)||this)._body=void 0,t._allowSleep=!0,S(t,"_mass",_,D(t)),S(t,"_linearDamping",g,D(t)),S(t,"_angularDamping",m,D(t)),S(t,"_fixedRotation",v,D(t)),S(t,"_isKinematic",w,D(t)),S(t,"_useGravity",O,D(t)),S(t,"_linearFactor",x,D(t)),S(t,"_angularFactor",P,D(t)),t}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,k(t,i);var o,n,a=r.prototype;return a.__preload=function(){},a.onEnable=function(){},a.onDisable=function(){},a.onDestroy=function(){},a.applyForce=function(){this._assertOnload},a.applyLocalForce=function(){this._assertOnload},a.applyImpulse=function(){this._assertOnload},a.applyLocalImpulse=function(){this._assertOnload},a.applyTorque=function(){this._assertOnload},a.applyLocalTorque=function(){this._assertOnload},a.wakeUp=function(){this._assertOnload},a.sleep=function(){this._assertOnload},a.getLinearVelocity=function(){this._assertOnload},a.setLinearVelocity=function(){this._assertOnload},a.getAngularVelocity=function(){this._assertOnload},a.setAngularVelocity=function(){this._assertOnload},o=r,(n=[{key:"allowSleep",get:function(){return this._allowSleep},set:function(e){this._allowSleep=e}},{key:"mass",get:function(){return this._mass},set:function(e){this._mass=e}},{key:"linearDamping",get:function(){return this._linearDamping},set:function(e){this._linearDamping=e}},{key:"angularDamping",get:function(){return this._angularDamping},set:function(e){this._angularDamping=e}},{key:"isKinematic",get:function(){return this._isKinematic},set:function(e){this._isKinematic=e}},{key:"useGravity",get:function(){return this._useGravity},set:function(e){this._useGravity=e}},{key:"fixedRotation",get:function(){return this._fixedRotation},set:function(e){this._fixedRotation=e}},{key:"linearFactor",get:function(){return this._linearFactor},set:function(e){q.copy(this._linearFactor,e)}},{key:"angularFactor",get:function(){return this._angularFactor},set:function(e){q.copy(this._angularFactor,e)}},{key:"isAwake",get:function(){return this._assertOnload,!1}},{key:"isSleepy",get:function(){return this._assertOnload,!1}},{key:"isSleeping",get:function(){return this._assertOnload,!1}},{key:"rigidBody",get:function(){return this._body}},{key:"_assertOnload",get:function(){var e=0==this._isOnLoadCalled;return e&&cc.error("Physics Error: Please make sure that the node has been added to the scene"),!e}}])&&M(o.prototype,n),Object.defineProperty(o,"prototype",{writable:!1}),r}(cc.Component)).prototype,"mass",[s],Object.getOwnPropertyDescriptor(b.prototype,"mass"),b.prototype),z(b.prototype,"linearDamping",[l],Object.getOwnPropertyDescriptor(b.prototype,"linearDamping"),b.prototype),z(b.prototype,"angularDamping",[c],Object.getOwnPropertyDescriptor(b.prototype,"angularDamping"),b.prototype),z(b.prototype,"isKinematic",[u],Object.getOwnPropertyDescriptor(b.prototype,"isKinematic"),b.prototype),z(b.prototype,"useGravity",[p],Object.getOwnPropertyDescriptor(b.prototype,"useGravity"),b.prototype),z(b.prototype,"fixedRotation",[d],Object.getOwnPropertyDescriptor(b.prototype,"fixedRotation"),b.prototype),z(b.prototype,"linearFactor",[h],Object.getOwnPropertyDescriptor(b.prototype,"linearFactor"),b.prototype),z(b.prototype,"angularFactor",[f],Object.getOwnPropertyDescriptor(b.prototype,"angularFactor"),b.prototype),_=z(b.prototype,"_mass",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),g=z(b.prototype,"_linearDamping",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),m=z(b.prototype,"_angularDamping",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),v=z(b.prototype,"_fixedRotation",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),w=z(b.prototype,"_isKinematic",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),O=z(b.prototype,"_useGravity",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),x=z(b.prototype,"_linearFactor",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new q(1,1,1)}}),P=z(b.prototype,"_angularFactor",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new q(1,1,1)}}),y=b))||y)||y)||y)||y)||y)||y);i.RigidBody3D=N},{"../instance":17}],16:[function(e,t,i){"use strict";i.__esModule=!0;var r=e("./physics-manager");i.Physics3DManager=r.Physics3DManager;var o=e("./physics-ray-result");i.PhysicsRayResult=o.PhysicsRayResult;var n=e("./components/collider/box-collider-component");i.BoxCollider3D=n.BoxCollider3D;var a=e("./components/collider/collider-component");i.Collider3D=a.Collider3D;var s=e("./components/collider/sphere-collider-component");i.SphereCollider3D=s.SphereCollider3D;var l=e("./components/rigid-body-component");i.RigidBody3D=l.RigidBody3D;var c=e("./components/constant-force"),u=e("./assets/physics-material");i.PhysicsMaterial=u.PhysicsMaterial,cc.Physics3DManager=r.Physics3DManager,cc.Collider3D=a.Collider3D,cc.BoxCollider3D=n.BoxCollider3D,cc.SphereCollider3D=s.SphereCollider3D,cc.RigidBody3D=l.RigidBody3D,cc.PhysicsRayResult=o.PhysicsRayResult,cc.ConstantForce=c.ConstantForce},{"./assets/physics-material":10,"./components/collider/box-collider-component":11,"./components/collider/collider-component":12,"./components/collider/sphere-collider-component":13,"./components/constant-force":14,"./components/rigid-body-component":15,"./physics-manager":18,"./physics-ray-result":19}],17:[function(e,t,i){"use strict";i.__esModule=!0,i.createBoxShape=function(e){return new r.BoxShape(e)},i.createPhysicsWorld=function(){return new r.PhysicsWorld},i.createRigidBody=function(){return new r.RigidBody},i.createSphereShape=function(e){return new r.SphereShape(e)};var r=e("./physics-selector")},{"./physics-selector":20}],18:[function(e,t,i){"use strict";i.__esModule=!0,i.Physics3DManager=void 0;var r,o,n,a,s,l,c,u,p=e("./instance"),d=(e("./assets/physics-material"),e("./physics-ray-result"));function h(e,t,i,r){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0})}function f(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e,t,i,r,o){var n={};return Object.keys(r).forEach(function(e){n[e]=r[e]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=i.slice().reverse().reduce(function(i,r){return r(e,t,i)||i},n),o&&void 0!==n.initializer&&(n.value=n.initializer?n.initializer.call(o):void 0,n.initializer=void 0),void 0===n.initializer&&(Object.defineProperty(e,t,n),n=null),n}var b=cc._decorator,_=b.property,g=(0,b.ccclass)("cc.Physics3DManager")((n=y((o=function(){function e(){this.physicsWorld=void 0,this.raycastClosestResult=new d.PhysicsRayResult,this.raycastResults=[],h(this,"_enabled",n,this),h(this,"_allowSleep",a,this),h(this,"_gravity",s,this),h(this,"_maxSubStep",l,this),h(this,"_fixedTime",c,this),h(this,"_useFixedTime",u,this),this.useAccumulator=!1,this._accumulator=0,this.useFixedDigit=!1,this.useInternalTime=!1,this.fixDigits={position:5,rotation:12,timeNow:3},this._deltaTime=0,this._lastTime=0,this._material=null,this.raycastOptions={groupIndex:-1,queryTrigger:!0,maxDistance:1/0},this.raycastResultPool=new cc.RecyclePool(function(){return new d.PhysicsRayResult},1),cc.director._scheduler&&cc.director._scheduler.enableForTarget(this),this.physicsWorld=(0,p.createPhysicsWorld)(),this._lastTime=performance.now()}var t,i,r=e.prototype;return r.update=function(e){if(this._enabled){if(this.useInternalTime){var t=parseFloat(performance.now().toFixed(this.fixDigits.timeNow));this._deltaTime=t>this._lastTime?(t-this._lastTime)/1e3:0,this._lastTime=t}else this._deltaTime=e;cc.director.emit(cc.Director.EVENT_BEFORE_PHYSICS),this.physicsWorld.step(this._fixedTime),cc.director.emit(cc.Director.EVENT_AFTER_PHYSICS)}},r.raycast=function(e,t,i,r){if(void 0===t&&(t=0),void 0===i&&(i=1/0),void 0===r&&(r=!0),this.raycastResultPool.reset(),this.raycastResults.length=0,"string"==typeof t){var o=cc.game.groupList.indexOf(t);-1==o&&(o=0),this.raycastOptions.groupIndex=o}else this.raycastOptions.groupIndex=t;return this.raycastOptions.maxDistance=i,this.raycastOptions.queryTrigger=r,this.physicsWorld.raycast(e,this.raycastOptions,this.raycastResultPool,this.raycastResults)?this.raycastResults:null},r.raycastClosest=function(e,t,i,r){if(void 0===t&&(t=0),void 0===i&&(i=1/0),void 0===r&&(r=!0),"string"==typeof t){var o=cc.game.groupList.indexOf(t);-1==o&&(o=0),this.raycastOptions.groupIndex=o}else this.raycastOptions.groupIndex=t;return this.raycastOptions.maxDistance=i,this.raycastOptions.queryTrigger=r,this.physicsWorld.raycastClosest(e,this.raycastOptions,this.raycastClosestResult)?this.raycastClosestResult:null},r._updateMaterial=function(){},t=e,(i=[{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e}},{key:"allowSleep",get:function(){return this._allowSleep},set:function(e){this._allowSleep=e}},{key:"maxSubStep",get:function(){return this._maxSubStep},set:function(e){this._maxSubStep=e}},{key:"deltaTime",get:function(){return this._fixedTime},set:function(e){this._fixedTime=e}},{key:"useFixedTime",get:function(){return this._useFixedTime},set:function(e){this._useFixedTime=e}},{key:"gravity",get:function(){return this._gravity},set:function(e){this._gravity.set(e)}},{key:"defaultMaterial",get:function(){return this._material}}])&&f(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),e}()).prototype,"_enabled",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),a=y(o.prototype,"_allowSleep",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),s=y(o.prototype,"_gravity",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new cc.Vec3(0,-10,0)}}),l=y(o.prototype,"_maxSubStep",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),c=y(o.prototype,"_fixedTime",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1/60}}),u=y(o.prototype,"_useFixedTime",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),r=o))||r;i.Physics3DManager=g},{"./assets/physics-material":10,"./instance":17,"./physics-ray-result":19}],19:[function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}i.__esModule=!0,i.PhysicsRayResult=void 0;var o=cc.Vec3,n=function(){function e(){this._hitPoint=new o,this._distance=0,this._collidier=null}var t,i,n=e.prototype;return n._assign=function(e,t,i){o.copy(this._hitPoint,e),this._distance=t,this._collidier=i},n.clone=function(){var t=new e;return o.copy(t._hitPoint,this._hitPoint),t._distance=this._distance,t._collidier=this._collidier,t},t=e,(i=[{key:"hitPoint",get:function(){return this._hitPoint}},{key:"distance",get:function(){return this._distance}},{key:"collider",get:function(){return this._collidier}}])&&r(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();i.PhysicsRayResult=n},{}],20:[function(e,t,i){"use strict";var r,o,n,a;i.__esModule=!0,i.SphereShape=i.RigidBody=i.PhysicsWorld=i.BoxShape=void 0,i.instantiate=function(e,t,s,l){i.BoxShape=r=e,i.SphereShape=o=t,i.RigidBody=n=s,i.PhysicsWorld=a=l},i.BoxShape=r,i.SphereShape=o,i.RigidBody=n,i.PhysicsWorld=a},{}],21:[function(e,t,i){"use strict";i.__esModule=!0,i.clearNodeTransformDirtyFlag=function(){for(var e in v){var t=v[e];t._localMatDirty&=~n,t._localMatDirty&a||(t._worldMatDirty=!1,t._renderFlag&=~s)}v={},h.length=0},i.clearNodeTransformRecord=function(){v={},h.length=0},i.getWrap=function(e){return e.__cc_wrapper__},i.setWrap=function(e,t){e.__cc_wrapper__=t},i.stringfyQuat=function(e){return"(x: "+e.x+", y: "+e.y+", z: "+e.z+", w: "+e.w+")"},i.stringfyVec3=function(e){return"(x: "+e.x+", y: "+e.y+", z: "+e.z+")"},i.updateWorldRT=function(e,t,i){var r=e.parent;r?(w(r,!0),u.transformMat4(f,t,c.invert(m,r._worldMatrix)),p.multiply(g,p.conjugate(g,r.__wrot),i),e.setPosition(f),e.setRotation(g)):(e.setPosition(t),e.setRotation(i))},i.updateWorldTransform=w,i.worldDirty=function(e){for(var t=e;t;){if(t._worldMatDirty)return!0;t=t._parent}return!1};var r=cc.Node._LocalDirtyFlag,o=r.PHYSICS_TRS,n=r.ALL_TRS,a=r.SKEW,s=cc.RenderFlow.FLAG_TRANSFORM,l=cc.Mat3,c=cc.Mat4,u=cc.Vec3,p=cc.Quat,d=cc.Trs,h=[],f=cc.v3(),y=cc.quat(),b=new l,_=b.m,g=cc.quat(),m=cc.mat4(),v={};function w(e,t){void 0===t&&(t=!1);for(var i,r,n,a,s,m,w,O,x=e,P=0,S=!1,M=0;x;){if(!t&&v[x._id]){M|=x._localMatDirty&o,S=S||!!M;break}h[P++]=x,x._localMatDirty&o&&(S=!0),x=x._parent}if(!S)return!1;for(h.length=P;P;)i=h[--P],!t&&(v[i._id]=i),r=i._worldMatrix,s=i._matrix,a=i._trs,m=i.__wpos=i.__wpos||cc.v3(),w=i.__wrot=i.__wrot||cc.quat(),O=i.__wscale=i.__wscale||cc.v3(),i._localMatDirty&o&&d.toMat4(s,a),i._localMatDirty|=M,(M|=i._localMatDirty&o)&o?(x?(n=x._worldMatrix,d.toPosition(f,a),u.transformMat4(m,f,n),c.multiply(r,n,s),d.toRotation(y,a),p.multiply(w,x.__wrot,y),l.fromQuat(b,p.conjugate(g,w)),l.multiplyMat4(b,b,r),O.x=_[0],O.y=_[4],O.z=_[8]):(d.toPosition(m,a),d.toRotation(w,a),d.toScale(O,a),c.copy(r,s)),x=i):x=i;return!0}},{}]},{},[9,8]);